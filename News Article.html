<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>News Article Widget</title>
    <link href="https://fonts.googleapis.com/css2?family=Source+Code+Pro:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        html, body {
            margin: 0;
            padding: 0;
            height: 100%;
            width: 100%;
            font-family: 'Source Code Pro', monospace;
            background-color: #000;
            color: #f0f0f0;
            display: flex;
            flex-direction: column;
        }

        .table-container {
            display: flex;
            flex-direction: column;
            flex: 1;
            background-color: #000;
            border: 1px solid #222;
            border-radius: 0;
            overflow: hidden; /* Children will handle scroll */
        }

        .title-bar {
            background-color: #1a1a1a;
            color: #fff;
            padding: 12px;
            font-size: 16px;
            font-weight: Bold;
            text-align: left;
            border-radius: 0;
            padding-left: 12px;
            border-bottom: 1px solid #222;
            flex-shrink: 0; 
        }

        .filter-container {
            background-color: #000; 
            padding: 10px;
            display: flex;
            justify-content: space-between; 
            flex-wrap: wrap;
            border-bottom: 1px solid #222; 
            flex-shrink: 0;
        }

        .filter-label {
            font-size: 14px;
            margin-right: 8px;
            color: #ddd;
            align-self: center; 
        }

        .news-container {
            flex: 1;
            overflow-y: auto;
            padding: 10px;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .news-item {
            background-color: #1a1a1a;
            padding: 12px; 
            border-radius: 5px;
            border: 1px solid #222;
            display: flex; 
            flex-direction: column; 
        }

        .news-title {
            font-size: 14px;
            font-weight: 700;
            color: #eee;
            margin-bottom: 8px; 
            cursor: pointer;
        }

        .news-title:hover {
            text-decoration: underline;
            color: #fff;
        }

        .news-meta {
            font-size: 11px; 
            color: #aaa;
            margin-top: 10px; 
            padding-top: 8px; 
            border-top: 1px solid #2a2a2a; 
            display: flex;
            justify-content: space-between; 
            align-items: center;
        }

        .news-description {
            font-size: 12px;
            color: #ccc;
            margin-top: 0; 
            margin-bottom: 10px; 
            line-height: 1.4; 
        }

        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: transparent;
        }

        ::-webkit-scrollbar-thumb {
            background-color: rgba(255,255,255,0.15); 
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background-color: rgba(255,255,255,0.25);
        }

        html { 
            scrollbar-width: thin;
            scrollbar-color: rgba(255,255,255,0.15) transparent;
        }

        #search-container {
            display: flex;
            align-items: center;
        }

        #search-input {
            background-color: #1a1a1a;
            border: 1px solid #333;
            padding: 6px 8px; 
            color: #fff;
            border-radius: 5px;
            margin-left: 10px;
            font-family: 'Source Code Pro', monospace; 
            font-size: 13px; 
        }
        .loading-message, .error-message { 
            color: #888;
            text-align: center;
            padding: 20px;
            font-style: italic;
        }
    </style>
</head>
<body>
    <div class="table-container">
        <div class="title-bar">News Articles</div>
        <div class="filter-container">
            <div id="search-container">
                <span class="filter-label">Search:</span>
                <input type="text" id="search-input" placeholder="Search headlines...">
            </div>
        </div>
        <div class="news-container" id="news-container">
            <div class='loading-message'>Loading articles...</div>
        </div>
    </div>
    <script>
        const DATA_ENDPOINT_URL = 'https://script.google.com/macros/s/AKfycbx3boNwL5no4GXnqmk6b8SOqzWksilI8XLgdQs26eaDrp3IzxQ33jvFqovbUeoxVK3l/exec';
        const SECRET_ACCESS_TOKEN = 'SMASHBUNNYDUNGEON'; 

        const newsContainer = document.getElementById("news-container");
        const searchInput = document.getElementById('search-input');
        let allNewsItems = []; 

        async function fetchNews() {
            newsContainer.innerHTML = "<div class='loading-message'>Fetching articles...</div>";
            try {
                const response = await fetch(`${DATA_ENDPOINT_URL}?token=${SECRET_ACCESS_TOKEN}`);
                
                if (!response.ok) {
                    let errorText = `Failed to fetch news. Status: ${response.status}`;
                    try {
                        const errorJson = await response.json(); 
                        errorText += ` - Message: ${errorJson.error || 'No additional details.'}`;
                        if(errorJson.details) errorText += ` Details: ${errorJson.details}`;
                    } catch (e) {
                        const rawErrorText = await response.text();
                        errorText += ` - Raw response: ${rawErrorText || 'No raw response.'}`;
                    }
                    throw new Error(errorText);
                }

                const data = await response.json();

                if (data.error) { 
                    throw new Error(`API Error: ${data.error}${data.details ? ' - ' + data.details : ''}`);
                }

                if (!Array.isArray(data)) {
                    console.error("Received data is not an array:", data);
                    throw new Error("Invalid data format received from API. Expected an array.");
                }
                
                allNewsItems = data.map(item => {
                    const utcDate = item.date ? new Date(item.date) : null; 
                    return {
                        DateObj: (utcDate && !isNaN(utcDate.getTime())) ? utcDate : null, 
                        Title: item.title || "No Title",            
                        Description: item.description || "",      
                        Link: item.link || "#"                    
                    };
                }).filter(item => item.DateObj);

                renderNews(allNewsItems);

            } catch (error) {
                console.error("Error fetching or processing news:", error);
                newsContainer.innerHTML = `<div class='error-message' style='color:red;'>Error loading articles: ${error.message}</div>`;
            }
        }

        function renderNews(newsItemsToRender) {
            newsContainer.innerHTML = ''; 

            if (newsItemsToRender.length === 0) {
                newsContainer.innerHTML = "<div class='loading-message'>No articles found.</div>";
                return;
            }

            newsItemsToRender.forEach(item => {
                const title = item.Title;
                let description = item.Description;
                // Mengubah locale ke 'en-US' untuk format Bahasa Inggris
                const dateStr = item.DateObj ? item.DateObj.toLocaleString('en-US', { 
                    year: 'numeric',
                    month: 'long', 
                    day: 'numeric',
                    hour: '2-digit', 
                    minute: '2-digit',
                    hour12: false, 
                    timeZone: 'Asia/Jakarta' // Tetap konversi ke WIB
                }) : "Invalid Date";
                const link = item.Link;

                if (description) {
                    description = description.replace(/(\d+\.\s)/g, '<br>&emsp;&bull; '); 
                }

                const newsItemDiv = document.createElement("div");
                newsItemDiv.className = "news-item";
                newsItemDiv.dataset.title = title; 
                newsItemDiv.dataset.description = description; 

                const titleElement = document.createElement("h2");
                titleElement.className = "news-title";
                titleElement.textContent = title;
                if (link && link !== '#') {
                    titleElement.onclick = () => window.open(link, '_blank');
                } else {
                    titleElement.style.cursor = 'default'; 
                    titleElement.onclick = null; 
                }
                
                const descriptionElement = document.createElement("p");
                descriptionElement.className = "news-description";
                descriptionElement.innerHTML = description; 

                const metaElement = document.createElement("div");
                metaElement.className = "news-meta";
                metaElement.textContent = dateStr;

                newsItemDiv.appendChild(titleElement);
                if (description.trim() !== "") { 
                    newsItemDiv.appendChild(descriptionElement);
                }
                newsItemDiv.appendChild(metaElement);

                newsContainer.appendChild(newsItemDiv);
            });
        }

        searchInput.addEventListener('input', () => {
            const searchTerm = searchInput.value.toLowerCase().trim();
            if (searchTerm === "") {
                renderNews(allNewsItems); 
                return;
            }
            const filteredNews = allNewsItems.filter(item => {
                const title = item.Title.toLowerCase();
                const description = (item.Description || "").toLowerCase(); 
                return title.includes(searchTerm) || description.includes(searchTerm);
            });
            renderNews(filteredNews);
        });

        fetchNews();
    </script>
</body>
</html>
